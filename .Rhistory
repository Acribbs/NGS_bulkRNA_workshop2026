sampleDists <- dist(t(assay(vsd)))
samplDistMatrix <- as.matrix(sampleDists)
rownames(samplDistMatrix) <- meta_data[[2]]
colnames(samplDistMatrix) <- meta_data[[3]]
colnames(samplDistMatrix) <- meta_data[[1]]
colors <- colorRampPalette(rev(brewer.pal(9, "Blues")) )(255)
pheatmap(samplDistMatrix,
clustering_distance_cols = sampleDists,
clustering_distance_rows = sampleDists,
color = colors)
plotPCA(vsd, intgroup=c(as.character(one)))
one <- colnames(meta_data)[[2]]
plotPCA(vsd, intgroup=c(as.character(one)))
plt <- DESeq2::plotMA(res)
plot_volcano <- function(res){
test <- as.data.frame(res)
data <- as.vector(rownames(test))
annots <-  AnnotationDbi::select(org.Hs.eg.db, keys=data,
columns="SYMBOL", keytype = "ENSEMBL")
result <- merge(test, annots, by.x="row.names", by.y="ENSEMBL")
res <- result %>%
dplyr::select(log2FoldChange, SYMBOL, baseMean, padj, Row.names) %>%
na.omit()
mutateddf <- mutate(res, sig=ifelse(res$padj<0.01, "padj<0.01", "Not Sig")) #Will have different colors depending on significance
input <- cbind(gene=rownames(mutateddf), mutateddf )
input <- input %>%
arrange(input$padj)
symbol_data <- head(input, 30)
#convert the rownames to a column
volc = ggplot(input, aes(log2FoldChange, -log10(padj))) + #volcanoplot with log2Foldchange versus pvalue
geom_point(aes(col=sig)) + #add points colored by significance
geom_point(data=symbol_data, aes(log2FoldChange, -log10(padj)), colour="red") +
ggtitle("Volcano") #e.g. 'Volcanoplot DESeq2'
#setEPS()
#postscript("MUG_volcano.eps")
volcano <- volc+geom_text_repel(data=symbol_data, aes(label=`SYMBOL`)) + scale_colour_Publication() + theme_bw()#adding text for the genes
return(volcano)
}
plt <- plot_volcano(res)
library(ggrepel)
plot_volcano <- function(res){
test <- as.data.frame(res)
data <- as.vector(rownames(test))
annots <-  AnnotationDbi::select(org.Hs.eg.db, keys=data,
columns="SYMBOL", keytype = "ENSEMBL")
result <- merge(test, annots, by.x="row.names", by.y="ENSEMBL")
res <- result %>%
dplyr::select(log2FoldChange, SYMBOL, baseMean, padj, Row.names) %>%
na.omit()
mutateddf <- mutate(res, sig=ifelse(res$padj<0.01, "padj<0.01", "Not Sig")) #Will have different colors depending on significance
input <- cbind(gene=rownames(mutateddf), mutateddf )
input <- input %>%
arrange(input$padj)
symbol_data <- head(input, 30)
#convert the rownames to a column
volc = ggplot(input, aes(log2FoldChange, -log10(padj))) + #volcanoplot with log2Foldchange versus pvalue
geom_point(aes(col=sig)) + #add points colored by significance
geom_point(data=symbol_data, aes(log2FoldChange, -log10(padj)), colour="red") +
ggtitle("Volcano") #e.g. 'Volcanoplot DESeq2'
#setEPS()
#postscript("MUG_volcano.eps")
volcano <- volc+geom_text_repel(data=symbol_data, aes(label=`SYMBOL`)) + scale_colour_Publication() + theme_bw()#adding text for the genes
return(volcano)
}
plt <- plot_volcano(res)
theme_Publication <- function(base_size=14, base_family="arial") {
library(grid)
library(ggthemes)
(theme_foundation(base_size=base_size, base_family=base_family)
+ theme(plot.title = element_text(face = "bold",
size = rel(1.2), hjust = 0.5),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = NA),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
axis.line = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_blank(),
legend.key = element_rect(colour = NA),
legend.position = "bottom",
legend.direction = "horizontal",
legend.key.size= unit(0.2, "cm"),
legend.title = element_text(face="italic"),
strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
strip.text = element_text(face="bold")
))
}
scale_fill_Publication <- function(...){
library(scales)
discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
scale_colour_Publication <- function(...){
library(scales)
discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
plt <- plot_volcano(res)
plt
select = order(rowMeans(assay(vsg)), decreasing = TRUE)[1:30]
select = order(rowMeans(assay(vsd)), decreasing = TRUE)[1:30]
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation_col = as.data.frame(
colData(pas_rlog)[, c("condition", "type")] ))
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation_col = as.data.frame(
colData(vsd)[, c("condition", "type")] ))
colData(vsd
)
colData(vsd)[, "disease")
pheatmap( assay(vsd)[select, ],
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation_col = as.data.frame(
colData(vsd)[, "disease"] ))
)
annotation_col = as.data.frame(
colData(vsd)[, "disease"] )
View(annotation_col)
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation=annotation)
knitr::opts_chunk$set(cache=TRUE)
library(org.Hs.eg.db)
library(DESeq2)
library(pheatmap)
library(dplyr)
library(RColorBrewer)
library(pheatmap)
library(ggplot2)
library(ggrepel)
df_mRNA <- read.table(gzfile("featurecounts.tsv.gz"), sep = "\t", header = TRUE, row.names = 1)
View(df_mRNA)
colnames(df_mRNA) <- gsub(".", "-", x = colnames(df_mRNA), fixed = T)
# import your design file
meta_data <- read.table("design.csv", sep=",", header = TRUE)
View(meta_data)
rownames(meta_data) <- meta_data$Sample
df_mRNA = df_mRNA[,rownames(meta_data)]
all(rownames(meta_data) %in% colnames(df_mRNA))
dds<- DESeqDataSetFromMatrix(countData=df_mRNA,
colData=meta_data,
design=~disease)
dds <- DESeq(dds)
res <- results(dds, contrast = c("disease", "GDM", "Normal"))
res[order(res$padj),] %>%  head
res_df <- data.frame(res[order(res$padj),])
View(res_df)
vsd <- varianceStabilizingTransformation(dds, blind=FALSE)
select <- order(rowMeans(counts(dds, normalized=TRUE)), decreasing=TRUE)[1:200]
data = colData(dds)[,3]
df <- as.data.frame(data)
annotation <- data.frame(Var1 = meta_data[[2]])
rownames(annotation) <- colnames(assay(vsd))
pheatmap(assay(vsd)[select,], cluster_rows = FALSE, show_rownames = FALSE,
cluster_cols = TRUE, annotation=annotation)
ggplot(res_df, aes(x = pvalue)) +
geom_histogram(binwidth = 0.01, fill = "Royalblue", boundary = 0)
sampleDists <- dist(t(assay(vsd)))
samplDistMatrix <- as.matrix(sampleDists)
rownames(samplDistMatrix) <- meta_data[[2]]
colnames(samplDistMatrix) <- meta_data[[1]]
colors <- colorRampPalette(rev(brewer.pal(9, "Blues")) )(255)
pheatmap(samplDistMatrix,
clustering_distance_cols = sampleDists,
clustering_distance_rows = sampleDists,
color = colors)
one <- colnames(meta_data)[[2]]
plotPCA(vsd, intgroup=c(as.character(one)))
plt <- DESeq2::plotMA(res)
theme_Publication <- function(base_size=14, base_family="arial") {
library(grid)
library(ggthemes)
(theme_foundation(base_size=base_size, base_family=base_family)
+ theme(plot.title = element_text(face = "bold",
size = rel(1.2), hjust = 0.5),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = NA),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
axis.line = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_blank(),
legend.key = element_rect(colour = NA),
legend.position = "bottom",
legend.direction = "horizontal",
legend.key.size= unit(0.2, "cm"),
legend.title = element_text(face="italic"),
strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
strip.text = element_text(face="bold")
))
}
scale_fill_Publication <- function(...){
library(scales)
discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
scale_colour_Publication <- function(...){
library(scales)
discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
plot_volcano <- function(res){
test <- as.data.frame(res)
data <- as.vector(rownames(test))
annots <-  AnnotationDbi::select(org.Hs.eg.db, keys=data,
columns="SYMBOL", keytype = "ENSEMBL")
result <- merge(test, annots, by.x="row.names", by.y="ENSEMBL")
res <- result %>%
dplyr::select(log2FoldChange, SYMBOL, baseMean, padj, Row.names) %>%
na.omit()
mutateddf <- mutate(res, sig=ifelse(res$padj<0.01, "padj<0.01", "Not Sig")) #Will have different colors depending on significance
input <- cbind(gene=rownames(mutateddf), mutateddf )
input <- input %>%
arrange(input$padj)
symbol_data <- head(input, 30)
#convert the rownames to a column
volc = ggplot(input, aes(log2FoldChange, -log10(padj))) + #volcanoplot with log2Foldchange versus pvalue
geom_point(aes(col=sig)) + #add points colored by significance
geom_point(data=symbol_data, aes(log2FoldChange, -log10(padj)), colour="red") +
ggtitle("Volcano") #e.g. 'Volcanoplot DESeq2'
#setEPS()
#postscript("MUG_volcano.eps")
volcano <- volc+geom_text_repel(data=symbol_data, aes(label=`SYMBOL`)) + scale_colour_Publication() + theme_bw()#adding text for the genes
return(volcano)
}
plt <- plot_volcano(res)
plt
select = order(rowMeans(assay(vsd)), decreasing = TRUE)[1:30]
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation=annotation)
knitr::opts_chunk$set(cache=TRUE)
library(org.Hs.eg.db)
library(DESeq2)
library(pheatmap)
library(dplyr)
library(RColorBrewer)
library(pheatmap)
library(ggplot2)
library(ggrepel)
if (file.exists("featurecounts.tsv.gz")) {
df_mRNA <- read.table(gzfile("featurecounts.tsv.gz"), sep = "\t", header = TRUE, row.names = 1)
colnames(df_mRNA) <- gsub(".", "-", x = colnames(df_mRNA), fixed = T)
} else {
print("Please add featurecounts.tsv.gz into the project folder as it seems to be missing")
}
# import your design file
meta_data <- read.table("design.csv", sep=",", header = TRUE)
rownames(meta_data) <- meta_data$Sample
df_mRNA = df_mRNA[,rownames(meta_data)]
all(rownames(meta_data) %in% colnames(df_mRNA))
dds<- DESeqDataSetFromMatrix(countData=df_mRNA,
colData=meta_data,
design=~disease)
is(df_mRNA, "SummarizedExperiment")
is(meta_data, "SummarizedExperiment")
is(dds, "SummarizedExperiment")
dds <- DESeq(dds)
res <- results(dds, contrast = c("disease", "GDM", "Normal"))
res[order(res$padj),] %>%  head
res_df <- data.frame(res[order(res$padj),])
vsd <- varianceStabilizingTransformation(dds, blind=FALSE)
select <- order(rowMeans(counts(dds, normalized=TRUE)), decreasing=TRUE)[1:200]
data = colData(dds)[,3]
df <- as.data.frame(data)
annotation <- data.frame(Var1 = meta_data[[2]])
rownames(annotation) <- colnames(assay(vsd))
pheatmap(assay(vsd)[select,], cluster_rows = FALSE, show_rownames = FALSE,
cluster_cols = TRUE, annotation=annotation)
ggplot(res_df, aes(x = pvalue)) +
geom_histogram(binwidth = 0.01, fill = "Royalblue", boundary = 0)
sampleDists <- dist(t(assay(vsd)))
samplDistMatrix <- as.matrix(sampleDists)
rownames(samplDistMatrix) <- meta_data[[2]]
colnames(samplDistMatrix) <- meta_data[[1]]
colors <- colorRampPalette(rev(brewer.pal(9, "Blues")) )(255)
pheatmap(samplDistMatrix,
clustering_distance_cols = sampleDists,
clustering_distance_rows = sampleDists,
color = colors)
one <- colnames(meta_data)[[2]]
plotPCA(vsd, intgroup=c(as.character(one)))
plt <- DESeq2::plotMA(res)
theme_Publication <- function(base_size=14, base_family="arial") {
library(grid)
library(ggthemes)
(theme_foundation(base_size=base_size, base_family=base_family)
+ theme(plot.title = element_text(face = "bold",
size = rel(1.2), hjust = 0.5),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = NA),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
axis.line = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_blank(),
legend.key = element_rect(colour = NA),
legend.position = "bottom",
legend.direction = "horizontal",
legend.key.size= unit(0.2, "cm"),
legend.title = element_text(face="italic"),
strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
strip.text = element_text(face="bold")
))
}
scale_fill_Publication <- function(...){
library(scales)
discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
scale_colour_Publication <- function(...){
library(scales)
discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
plot_volcano <- function(res){
test <- as.data.frame(res)
data <- as.vector(rownames(test))
annots <-  AnnotationDbi::select(org.Hs.eg.db, keys=data,
columns="SYMBOL", keytype = "ENSEMBL")
result <- merge(test, annots, by.x="row.names", by.y="ENSEMBL")
res <- result %>%
dplyr::select(log2FoldChange, SYMBOL, baseMean, padj, Row.names) %>%
na.omit()
mutateddf <- mutate(res, sig=ifelse(res$padj<0.01, "padj<0.01", "Not Sig")) #Will have different colors depending on significance
input <- cbind(gene=rownames(mutateddf), mutateddf )
input <- input %>%
arrange(input$padj)
symbol_data <- head(input, 30)
#convert the rownames to a column
volc = ggplot(input, aes(log2FoldChange, -log10(padj))) + #volcanoplot with log2Foldchange versus pvalue
geom_point(aes(col=sig)) + #add points colored by significance
geom_point(data=symbol_data, aes(log2FoldChange, -log10(padj)), colour="red") +
ggtitle("Volcano") #e.g. 'Volcanoplot DESeq2'
#setEPS()
#postscript("MUG_volcano.eps")
volcano <- volc+geom_text_repel(data=symbol_data, aes(label=`SYMBOL`)) + scale_colour_Publication() + theme_bw()#adding text for the genes
return(volcano)
}
plt <- plot_volcano(res)
plt
select = order(rowMeans(assay(vsd)), decreasing = TRUE)[1:30]
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation=annotation)
knitr::opts_chunk$set(cache=TRUE)
library(org.Hs.eg.db)
library(DESeq2)
library(pheatmap)
library(dplyr)
library(RColorBrewer)
library(pheatmap)
library(ggplot2)
library(ggrepel)
if (file.exists("featurecounts.tsv.gz")) {
df_mRNA <- read.table(gzfile("featurecounts.tsv.gz"), sep = "\t", header = TRUE, row.names = 1)
colnames(df_mRNA) <- gsub(".", "-", x = colnames(df_mRNA), fixed = T)
} else {
print("Please add featurecounts.tsv.gz into the project folder as it seems to be missing")
}
# import your design file
meta_data <- read.table("design.csv", sep=",", header = TRUE)
rownames(meta_data) <- meta_data$Sample
df_mRNA = df_mRNA[,rownames(meta_data)]
all(rownames(meta_data) %in% colnames(df_mRNA))
View(meta_data)
reticulate::repl_python()
n
knitr::opts_chunk$set(echo = TRUE)
reticulate::repl_python()
knitr::opts_chunk$set(cache=TRUE)
library(org.Hs.eg.db)
library(DESeq2)
library(pheatmap)
library(dplyr)
library(RColorBrewer)
library(pheatmap)
library(ggplot2)
library(ggrepel)
View(meta_data)
View(df_mRNA)
df_mRNA <- read.table(gzfile("featurecounts.tsv.gz"), sep = "\t", header = TRUE, row.names = 1)
View(df_mRNA)
colnames(df_mRNA) <- gsub(".", "-", x = colnames(df_mRNA), fixed = T)
View(df_mRNA)
all(rownames(meta_data) %in% colnames(df_mRNA))
View(meta_data)
dds<- DESeqDataSetFromMatrix(countData=df_mRNA,
colData=meta_data,
design=~disease)
if (file.exists("featurecounts.tsv.gz")) {
df_mRNA <- read.table(gzfile("featurecounts.tsv.gz"), sep = "\t", header = TRUE, row.names = 1)
colnames(df_mRNA) <- gsub(".", "-", x = colnames(df_mRNA), fixed = T)
} else {
print("Please add featurecounts.tsv.gz into the project folder as it seems to be missing")
}
# import your design file
meta_data <- read.table("design.csv", sep=",", header = TRUE)
rownames(meta_data) <- meta_data$Sample
df_mRNA = df_mRNA[,rownames(meta_data)]
all(rownames(meta_data) %in% colnames(df_mRNA))
dds<- DESeqDataSetFromMatrix(countData=df_mRNA,
colData=meta_data,
design=~disease)
is(df_mRNA, "SummarizedExperiment")
is(meta_data, "SummarizedExperiment")
is(dds, "SummarizedExperiment")
dds <- DESeq(dds)
res <- results(dds, contrast = c("disease", "GDM", "Normal"))
res[order(res$padj),] %>%  head
res_df <- data.frame(res[order(res$padj),])
View(res_df)
vsd <- varianceStabilizingTransformation(dds, blind=FALSE)
select <- order(rowMeans(counts(dds, normalized=TRUE)), decreasing=TRUE)[1:200]
data = colData(dds)[,3]
df <- as.data.frame(data)
View(df)
annotation <- data.frame(Var1 = meta_data[[2]])
rownames(annotation) <- colnames(assay(vsd))
pheatmap(assay(vsd)[select,], cluster_rows = FALSE, show_rownames = FALSE,
cluster_cols = TRUE, annotation=annotation)
ggplot(res_df, aes(x = pvalue)) +
geom_histogram(binwidth = 0.01, fill = "Royalblue", boundary = 0)
sampleDists <- dist(t(assay(vsd)))
samplDistMatrix <- as.matrix(sampleDists)
rownames(samplDistMatrix) <- meta_data[[2]]
colnames(samplDistMatrix) <- meta_data[[1]]
colors <- colorRampPalette(rev(brewer.pal(9, "Blues")) )(255)
pheatmap(samplDistMatrix,
clustering_distance_cols = sampleDists,
clustering_distance_rows = sampleDists,
color = colors)
one <- colnames(meta_data)[[2]]
plotPCA(vsd, intgroup=c(as.character(one)))
plt <- DESeq2::plotMA(res)
theme_Publication <- function(base_size=14, base_family="arial") {
library(grid)
library(ggthemes)
(theme_foundation(base_size=base_size, base_family=base_family)
+ theme(plot.title = element_text(face = "bold",
size = rel(1.2), hjust = 0.5),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = NA),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
axis.line = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_blank(),
legend.key = element_rect(colour = NA),
legend.position = "bottom",
legend.direction = "horizontal",
legend.key.size= unit(0.2, "cm"),
legend.title = element_text(face="italic"),
strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
strip.text = element_text(face="bold")
))
}
scale_fill_Publication <- function(...){
library(scales)
discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
scale_colour_Publication <- function(...){
library(scales)
discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
plot_volcano <- function(res){
test <- as.data.frame(res)
data <- as.vector(rownames(test))
annots <-  AnnotationDbi::select(org.Hs.eg.db, keys=data,
columns="SYMBOL", keytype = "ENSEMBL")
result <- merge(test, annots, by.x="row.names", by.y="ENSEMBL")
res <- result %>%
dplyr::select(log2FoldChange, SYMBOL, baseMean, padj, Row.names) %>%
na.omit()
mutateddf <- mutate(res, sig=ifelse(res$padj<0.01, "padj<0.01", "Not Sig")) #Will have different colors depending on significance
input <- cbind(gene=rownames(mutateddf), mutateddf )
input <- input %>%
arrange(input$padj)
symbol_data <- head(input, 30)
#convert the rownames to a column
volc = ggplot(input, aes(log2FoldChange, -log10(padj))) + #volcanoplot with log2Foldchange versus pvalue
geom_point(aes(col=sig)) + #add points colored by significance
geom_point(data=symbol_data, aes(log2FoldChange, -log10(padj)), colour="red") +
ggtitle("Volcano") #e.g. 'Volcanoplot DESeq2'
#setEPS()
#postscript("MUG_volcano.eps")
volcano <- volc+geom_text_repel(data=symbol_data, aes(label=`SYMBOL`)) + scale_colour_Publication() + theme_bw()#adding text for the genes
return(volcano)
}
plt <- plot_volcano(res)
plt
select = order(rowMeans(assay(vsd)), decreasing = TRUE)[1:30]
pheatmap( assay(vsd)[select, ],
scale = "row",
annotation=annotation)
