"0","# Select top 30 most significant genes"
"0","top_genes <- res_df %>%"
"0","  filter(!is.na(padj)) %>%"
"0","  arrange(padj) %>%"
"0","  head(30) %>%"
"0","  pull(EnsemblID)"
"0",""
"0","# Extract VST-transformed counts"
"0","vsd_subset <- vsd[top_genes, ]"
"0",""
"0","# Calculate z-scores for visualization"
"0","mat <- assay(vsd_subset)"
"0","mat <- mat - rowMeans(mat)"
"0","mat <- mat / apply(mat, 1, sd)"
"0",""
"0","# Add gene symbols as row names"
"0","rownames(mat) <- res_df$GeneSymbol[match(rownames(mat), res_df$EnsemblID)]"
"0",""
"0","# Create annotation"
"0","annotation_col <- data.frame("
"0","  Treatment = colData(vsd_subset)$Treatment,"
"0","  CellLine = colData(vsd_subset)$CellLine,"
"0","  row.names = colnames(mat)"
"0",")"
"0",""
"0","# Plot heatmap"
"0","pheatmap(mat,"
"0","         annotation_col = annotation_col,"
"0","         color = colorRampPalette(c(""navy"", ""white"", ""firebrick""))(100),"
"0","         show_rownames = TRUE,"
"0","         show_colnames = FALSE,"
"0","         cluster_cols = TRUE,"
"0","         main = ""Top 30 Most Significant DE Genes"")"
