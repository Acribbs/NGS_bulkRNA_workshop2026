"0","# Check input data"
"0","cat(""Counts file columns:"", paste(colnames(counts), collapse = "", ""), ""\n"")"
"1","Counts file columns:"
"1"," "
"1","EnsemblID, GeneSymbol, MCL1.LA, MCL1.LB, MCL1.LC, MCL1.LD, MCL1.LE, MCL1.LF, MCL1.DG, MCL1.DH, MCL1.DI, MCL1.DJ, MCL1.DK, MCL1.DL"
"1"," "
"1","
"
"0","cat(""Number of columns in counts:"", ncol(counts), ""\n"")"
"1","Number of columns in counts:"
"1"," "
"1","14"
"1"," "
"1","
"
"0","# Extract sample columns (everything except EnsemblID and GeneSymbol)"
"0","sample_cols <- setdiff(colnames(counts), c(""EnsemblID"", ""GeneSymbol""))"
"0","cat(""Sample columns found:"", length(sample_cols), ""\n"")"
"1","Sample columns found:"
"1"," "
"1","12"
"1"," "
"1","
"
"0","cat(""Sample column names:"", paste(sample_cols, collapse = "", ""), ""\n"")"
"1","Sample column names:"
"1"," "
"1","MCL1.LA, MCL1.LB, MCL1.LC, MCL1.LD, MCL1.LE, MCL1.LF, MCL1.DG, MCL1.DH, MCL1.DI, MCL1.DJ, MCL1.DK, MCL1.DL"
"1"," "
"1","
"
"0","if (length(sample_cols) == 0) {"
"0","  stop(""No sample columns found in counts file. Please check the file format."")"
"0","}"
"0",""
"0","# Create count matrix and preserve column names"
"0","count_matrix <- as.matrix(counts[, sample_cols, drop = FALSE])"
"0",""
"0","# Ensure column names are preserved"
"0","if (is.null(colnames(count_matrix))) {"
"0","  cat(""Warning: Column names were lost. Restoring from sample_cols.\n"")"
"0","  colnames(count_matrix) <- sample_cols"
"0","}"
"0",""
"0","# Set row names to EnsemblID"
"0","if (!is.null(counts$EnsemblID)) {"
"0","  rownames(count_matrix) <- counts$EnsemblID"
"0","} else {"
"0","  stop(""EnsemblID column not found in counts file."")"
"0","}"
"0",""
"0","# Clean sample names if needed (remove .bam or .sam extensions)"
"0","colnames(count_matrix) <- gsub(""\\.(bam|sam)$"", """", colnames(count_matrix))"
"0",""
"0","# Verify count matrix"
"0","cat(""Count matrix dimensions:"", dim(count_matrix), ""\n"")"
"1","Count matrix dimensions:"
"1"," "
"1","24094"
"1"," "
"1","12"
"1"," "
"1","
"
"0","cat(""Count matrix has column names:"", !is.null(colnames(count_matrix)), ""\n"")"
"1","Count matrix has column names:"
"1"," "
"1","TRUE"
"1"," "
"1","
"
"0","cat(""Sample names in counts:"", paste(colnames(count_matrix), collapse = "", ""), ""\n"")"
"1","Sample names in counts:"
"1"," "
"1","MCL1.LA, MCL1.LB, MCL1.LC, MCL1.LD, MCL1.LE, MCL1.LF, MCL1.DG, MCL1.DH, MCL1.DI, MCL1.DJ, MCL1.DK, MCL1.DL"
"1"," "
"1","
"
"0","cat(""Sample names in metadata:"", paste(metadata$Sample, collapse = "", ""), ""\n"")"
"1","Sample names in metadata:"
"1"," "
"1","GSM1480291, GSM1480292, GSM1480293, GSM1480294, GSM1480295, GSM1480296, GSM1480297, GSM1480298, GSM1480299, GSM1480300, GSM1480301, GSM1480302"
"1"," "
"1","
"
"0","# Try to match sample names - they might have different formats"
"0","# First, try exact match"
"0","samples_in_both <- intersect(colnames(count_matrix), metadata$Sample)"
"0","cat(""Exact matches found:"", length(samples_in_both), ""\n"")"
"1","Exact matches found:"
"1"," "
"1","0"
"1"," "
"1","
"
"0","# If no exact matches, try to find partial matches or clean names"
"0","if (length(samples_in_both) == 0) {"
"0","  cat(""\nNo exact matches found. Attempting to match sample names...\n"")"
"0","  "
"0","  # Try removing common prefixes/suffixes and matching"
"0","  count_names_clean <- colnames(count_matrix)"
"0","  metadata_names_clean <- metadata$Sample"
"0","  "
"0","  # Try various cleaning strategies"
"0","  # Remove file extensions"
"0","  count_names_clean <- gsub(""\\.(txt|tsv|csv|gz)$"", """", count_names_clean)"
"0","  metadata_names_clean <- gsub(""\\.(txt|tsv|csv|gz)$"", """", metadata_names_clean)"
"0","  "
"0","  # Remove common prefixes"
"0","  count_names_clean <- gsub(""^X"", """", count_names_clean)"
"0","  metadata_names_clean <- gsub(""^X"", """", metadata_names_clean)"
"0","  "
"0","  # Try matching cleaned names"
"0","  samples_in_both <- intersect(count_names_clean, metadata_names_clean)"
"0","  if (length(samples_in_both) > 0) {"
"0","    cat(""Found"", length(samples_in_both), ""matches after cleaning names\n"")"
"0","    # Update column names to match"
"0","    colnames(count_matrix) <- count_names_clean"
"0","    metadata$Sample <- metadata_names_clean"
"0","  } else {"
"0","    # Try matching by position if same number of samples"
"0","    if (ncol(count_matrix) == nrow(metadata)) {"
"0","      cat(""Same number of samples found. Attempting to match by position...\n"")"
"0","      cat(""This assumes samples are in the same order in both files.\n"")"
"0","      # We'll match by position in prepare-metadata chunk"
"0","    } else {"
"0","      cat(""\nERROR: Cannot match samples automatically.\n"")"
"0","      cat(""Count matrix samples:"", paste(colnames(count_matrix), collapse = "", ""), ""\n"")"
"0","      cat(""Metadata samples:"", paste(metadata$Sample, collapse = "", ""), ""\n"")"
"0","      cat(""\nPlease check that sample names match between files.\n"")"
"0","      cat(""You may need to manually rename samples in one of the files.\n"")"
"0","    }"
"0","  }"
"0","} else {"
"0","  cat(""Found"", length(samples_in_both), ""exact matches\n"")"
"0","}"
"1","
No exact matches found. Attempting to match sample names...
"
"1","Same number of samples found. Attempting to match by position...
"
"1","This assumes samples are in the same order in both files.
"
"0","if (length(samples_in_both) < length(metadata$Sample)) {"
"0","  cat(""Warning: Some metadata samples not found in counts\n"")"
"0","  cat(""Missing from counts:"", paste(setdiff(metadata$Sample, colnames(count_matrix)), collapse = "", ""), ""\n"")"
"0","}"
"1","Warning: Some metadata samples not found in counts
"
"1","Missing from counts:"
"1"," "
"1","GSM1480291, GSM1480292, GSM1480293, GSM1480294, GSM1480295, GSM1480296, GSM1480297, GSM1480298, GSM1480299, GSM1480300, GSM1480301, GSM1480302"
"1"," "
"1","
"
"0","if (length(samples_in_both) < length(colnames(count_matrix))) {"
"0","  cat(""Warning: Some count samples not found in metadata\n"")"
"0","  cat(""Missing from metadata:"", paste(setdiff(colnames(count_matrix), metadata$Sample), collapse = "", ""), ""\n"")"
"0","}"
"1","Warning: Some count samples not found in metadata
"
"1","Missing from metadata:"
"1"," "
"1","MCL1.LA, MCL1.LB, MCL1.LC, MCL1.LD, MCL1.LE, MCL1.LF, MCL1.DG, MCL1.DH, MCL1.DI, MCL1.DJ, MCL1.DK, MCL1.DL"
"1"," "
"1","
"
