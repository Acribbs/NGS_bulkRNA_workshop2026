"0","# Extract cluster information"
"0","cluster_info <- patterns$df"
"0",""
"0","# Create long format data for plotting (from expression matrix)"
"0","pattern_data <- expression_matrix %>%"
"0","  as.data.frame() %>%"
"0","  tibble::rownames_to_column(""genes"") %>%"
"0","  tidyr::pivot_longer(cols = -genes, names_to = ""samplename"", values_to = ""value"") %>%"
"0","  left_join("
"0","    metadata_patterns %>%"
"0","      tibble::rownames_to_column(""samplename"") %>%"
"0","      select(samplename, Status, CellType, Group),"
"0","    by = ""samplename"""
"0","  )"
"0",""
"0","# Merge with cluster information"
"0","pattern_data_clustered <- pattern_data %>%"
"0","  left_join(cluster_info[, c(""genes"", ""cluster"")], by = ""genes"")"
"0",""
"0","# Calculate mean expression per cluster and group"
"0","cluster_means <- pattern_data_clustered %>%"
"0","  group_by(cluster, CellType, Status) %>%"
"0","  summarize(mean_expression = mean(value), .groups = ""drop"")"
"0",""
"0","# Plot patterns"
"0","ggplot(cluster_means, aes(x = Status, y = mean_expression, "
"0","                          color = CellType, group = CellType)) +"
"0","  geom_line(size = 1.2) +"
"0","  geom_point(size = 3) +"
"0","  facet_wrap(~ cluster, scales = ""free_y"") +"
"0","  theme_bw() +"
"0","  labs(title = ""Expression Patterns by Cluster"","
"0","       y = ""Mean VST Expression"","
"0","       x = ""Developmental Stage"") +"
"0","  scale_color_manual(values = c(""basal"" = ""steelblue"", ""luminal"" = ""coral"")) +"
"0","  theme(axis.text.x = element_text(angle = 45, hjust = 1))"
